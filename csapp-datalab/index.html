<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>CSAPP:datalab - Isaray&#39;s blog</title><meta name="Description" content="How to solve datalab?"><meta property="og:title" content="CSAPP:datalab" />
<meta property="og:description" content="How to solve datalab?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://Isaray.github.io/csapp-datalab/" /><meta property="og:image" content="https://Isaray.github.io/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-01-31T16:00:34+08:00" />
<meta property="article:modified_time" content="2022-01-31T16:05:15+08:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://Isaray.github.io/logo.png"/>

<meta name="twitter:title" content="CSAPP:datalab"/>
<meta name="twitter:description" content="How to solve datalab?"/>
<meta name="application-name" content="LoveIt">
<meta name="apple-mobile-web-app-title" content="LoveIt"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://Isaray.github.io/csapp-datalab/" /><link rel="prev" href="https://Isaray.github.io/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" /><link rel="next" href="https://Isaray.github.io/csapp-bomblab/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "CSAPP:datalab",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/Isaray.github.io\/csapp-datalab\/"
        },"genre": "posts","keywords": "CSAPP, Courses","wordcount":  1852 ,
        "url": "https:\/\/Isaray.github.io\/csapp-datalab\/","datePublished": "2021-01-31T16:00:34+08:00","dateModified": "2022-01-31T16:05:15+08:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Isaray"
            },"description": "How to solve datalab?"
    }
    </script><style>
             
.search {
    position: relative;
    padding-top: 3.5rem;
    padding-bottom: 1rem;
    width: 57.5%;
    margin: 0 auto;
    background: white;
    opacity: .95;
}
[theme=dark] .search {
    background: #3a3535;
}

[theme=dark] .search header,
.search header {
    background-color: #f8f8f8;
}

[theme=dark] .search header:hover,
.search header:hover {
    -webkit-box-shadow: none;
    box-shadow: none;
}

.search header h1 {
    padding-left: 1rem;
    background: white;
}
[theme=dark] .search header h1 {
    background: #3a3535;
}

[theme=dark] .search input,
.search input {
	height: initial;
    width: initial;
    color: initial;
	background-color: white;
	margin: 0 0 0 1rem;
	border-width: 2px;
    border-style: inset;
    border-color: initial;
    border-image: initial;
	-webkit-border-radius: 0;
    -moz-border-radius: 0;
    border-radius: 0;
}

.search #search-results {
    padding-left: 1rem;
    padding-right: 1rem;
}

[theme=dark] a:active, [theme=dark] a:hover {
    color: #2d96bd;
}

.search hr {
    margin-left: 1rem;
    margin-right: 1rem;
}

        </style>
    </head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Isaray&#39;s blog">Isaray&#39;s blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/categories/projects/"> Projects </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/about/"> About </a><a class="menu-item" href="/search/"><i class='fas fa-fw fa-search'></i> search </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Isaray&#39;s blog">Isaray&#39;s blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/categories/projects/" title="">Projects</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/about/" title="">About</a><a class="menu-item" href="/search/" title=""><i class='fas fa-fw fa-search'></i>search</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container">
                    <div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">CSAPP:datalab</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>Isaray</a></span>&nbsp;<span class="post-category">included in <a href="/categories/experiments/"><i class="far fa-folder fa-fw"></i>Experiments</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2021-01-31">2021-01-31</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;1852 words&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;9 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#1bitand-">1.bitAnd ：</a></li>
    <li><a href="#2getbyte">2.getByte:</a></li>
    <li><a href="#3logicalshift">3.logicalShift:</a></li>
    <li><a href="#4bitcount">4.bitCount:</a></li>
    <li><a href="#5bang">5.bang:</a></li>
    <li><a href="#6tmin">6.tmin:</a></li>
    <li><a href="#7fitsbits">7.fitsBits:</a></li>
    <li><a href="#8divpwr2">8.divpwr2:</a></li>
    <li><a href="#9negate">9.negate:</a></li>
    <li><a href="#10ispositive">10.isPositive:</a></li>
    <li><a href="#11islessorequal">11.isLessOrEqual:</a></li>
    <li><a href="#12ilog2">12.ilog2:</a></li>
    <li><a href="#13float_neg">13.float_neg:</a></li>
    <li><a href="#14float_i2f">14.float_i2f:</a></li>
    <li><a href="#15float_twice">15.float_twice:</a></li>
    <li><a href="#结果">结果：</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h1 id="csappdatalab">CSAPP:datalab</h1>
<p>代码中有具体思路的标注。
以下为实验的说明，每道题目中有规定一些运算符能否使用，使用的符号个数，并规定一些控制结构和函数不能使用。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/* 
</span><span class="cm"> * CS:APP Data Lab 
</span><span class="cm"> * 
</span><span class="cm"> * 
</span><span class="cm"> * bits.c - Source file with your solutions to the Lab.
</span><span class="cm"> *          This is the file you will hand in to your instructor.
</span><span class="cm"> *
</span><span class="cm"> * WARNING: Do not include the &lt;stdio.h&gt; header; it confuses the dlc
</span><span class="cm"> * compiler. You can still use printf for debugging without including
</span><span class="cm"> * &lt;stdio.h&gt;, although you might get a compiler warning. In general,
</span><span class="cm"> * it&#39;s not good practice to ignore compiler warnings, but in this
</span><span class="cm"> * case it&#39;s OK.  
</span><span class="cm"> */</span>

<span class="cp">#if 0</span><span class="c">
</span><span class="c">
</span><span class="c">  Each &#34;Expr&#34; is an expression using ONLY the following:
</span><span class="c">  1. Integer constants 0 through 255 (0xFF), inclusive. You are
</span><span class="c">      not allowed to use big constants such as 0xffffffff.
</span><span class="c">  2. Function arguments and local variables (no global variables).
</span><span class="c">  3. Unary integer operations ! ~
</span><span class="c">  4. Binary integer operations &amp; ^ | + &lt;&lt; &gt;&gt;
</span><span class="c">  
</span><span class="c">  Some of the problems restrict the set of allowed operators even further.
</span><span class="c">  Each &#34;Expr&#34; may consist of multiple operators. You are not restricted to
</span><span class="c">  one operator per line.
</span><span class="c">
</span><span class="c">  You are expressly forbidden to:
</span><span class="c">  1. Use any control constructs such as if, do, while, for, switch, etc.
</span><span class="c">  2. Define or use any macros.
</span><span class="c">  3. Define any additional functions in this file.
</span><span class="c">  4. Call any functions.
</span><span class="c">  5. Use any other operations, such as &amp;&amp;, ||, -, or ?:
</span><span class="c">  6. Use any form of casting.
</span><span class="c">  7. Use any data type other than int.  This implies that you
</span><span class="c">     cannot use arrays, structs, or unions.
</span><span class="c">
</span><span class="c"> 
</span><span class="c">  You may assume that your machine:
</span><span class="c">  1. Uses 2s complement, 32-bit representations of integers.
</span><span class="c">  2. Performs right shifts arithmetically.
</span><span class="c">  3. Has unpredictable behavior when shifting an integer by more
</span><span class="c">     than the word size.
</span><span class="c">
</span><span class="c">EXAMPLES OF ACCEPTABLE CODING STYLE:
</span><span class="c">  /*
</span><span class="c">   * pow2plus1 - returns 2^x + 1, where 0 &lt;= x &lt;= 31
</span><span class="c">   */
</span><span class="c">  int pow2plus1(int x) {
</span><span class="c">     /* exploit ability of shifts to compute powers of 2 */
</span><span class="c">     return (1 &lt;&lt; x) + 1;
</span><span class="c">  }
</span><span class="c">
</span><span class="c">  /*
</span><span class="c">   * pow2plus4 - returns 2^x + 4, where 0 &lt;= x &lt;= 31
</span><span class="c">   */
</span><span class="c">  int pow2plus4(int x) {
</span><span class="c">     /* exploit ability of shifts to compute powers of 2 */
</span><span class="c">     int result = (1 &lt;&lt; x);
</span><span class="c">     result += 4;
</span><span class="c">     return result;
</span><span class="c">  }
</span><span class="c">
</span><span class="c">FLOATING POINT CODING RULES
</span><span class="c">
</span><span class="c">For the problems that require you to implent floating-point operations,
</span><span class="c">the coding rules are less strict.  You are allowed to use looping and
</span><span class="c">conditional control.  You are allowed to use both ints and unsigneds.
</span><span class="c">You can use arbitrary integer and unsigned constants.
</span><span class="c">
</span><span class="c">You are expressly forbidden to:
</span><span class="c">  1. Define or use any macros.
</span><span class="c">  2. Define any additional functions in this file.
</span><span class="c">  3. Call any functions.
</span><span class="c">  4. Use any form of casting.
</span><span class="c">  5. Use any data type other than int or unsigned.  This means that you
</span><span class="c">     cannot use arrays, structs, or unions.
</span><span class="c">  6. Use any floating point data types, operations, or constants.
</span><span class="c">
</span><span class="c">
</span><span class="c">NOTES:
</span><span class="c">  1. Use the dlc (data lab checker) compiler (described in the handout) to 
</span><span class="c">     check the legality of your solutions.
</span><span class="c">  2. Each function has a maximum number of operators (! ~ &amp; ^ | + &lt;&lt; &gt;&gt;)
</span><span class="c">     that you are allowed to use for your implementation of the function. 
</span><span class="c">     The max operator count is checked by dlc. Note that &#39;=&#39; is not 
</span><span class="c">     counted; you may use as many of these as you want without penalty.
</span><span class="c">  3. Use the btest test harness to check your functions for correctness.
</span><span class="c">  4. Use the BDD checker to formally verify your functions
</span><span class="c">  5. The maximum number of ops for each function is given in the
</span><span class="c">     header comment for each function. If there are any inconsistencies 
</span><span class="c">     between the maximum ops in the writeup and in this file, consider
</span><span class="c">     this file the authoritative source.
</span><span class="c">
</span></code></pre></td></tr></table>
</div>
</div><p>以下为所需要写的函数，每个函数的说明和限制都在注释中有具体讲解。</p>
<h2 id="1bitand-">1.bitAnd ：</h2>
<blockquote>
<p>不用&amp;，而用|表示&amp;。两者像照镜子，&amp;是同1则1，|是同0则0，用德摩根律，一反再反刚好对称过来。</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/* 
</span><span class="cm"> * bitAnd - x&amp;y using only ~ and | 
</span><span class="cm"> *   Example: bitAnd(6, 5) = 4
</span><span class="cm"> *   Legal ops: ~ |
</span><span class="cm"> *   Max ops: 8
</span><span class="cm"> *   Rating: 1
</span><span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">bitAnd</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/*It&#39;s equal to find the position that both are 0 and find its reversed version.有点像德摩根律。*/</span>
  <span class="k">return</span> <span class="o">~</span><span class="p">(</span><span class="o">~</span><span class="n">x</span><span class="o">|~</span><span class="n">y</span><span class="p">);</span>
 <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="2getbyte">2.getByte:</h2>
<blockquote>
<p>先算数左移再算数右移，再减去算数右移增加的补位数</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/* 
</span><span class="cm">* getByte - Extract byte n from word x
</span><span class="cm">*   Bytes numbered from 0 (LSB) to 3 (MSB)
</span><span class="cm">*   Examples: getByte(0x12345678,1) = 0x56
</span><span class="cm">*   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;
</span><span class="cm">*   Max ops: 6
</span><span class="cm">*   Rating: 2
</span><span class="cm">*/</span>
<span class="kt">int</span> <span class="nf">getByte</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
 <span class="cm">/*先算数左移再算数右移，再减去算数右移增加的补位数*/</span>
 <span class="kt">int</span> <span class="n">t</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">;</span>
 <span class="n">t1</span><span class="o">=</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="p">((</span><span class="mi">3</span><span class="o">-</span><span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="mi">4</span><span class="p">);</span>
 <span class="n">t2</span><span class="o">=</span><span class="n">t1</span><span class="o">&gt;&gt;</span><span class="mi">7</span><span class="o">*</span><span class="mi">4</span><span class="o">&gt;&gt;</span><span class="mi">4</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="mi">4</span><span class="p">);</span>
 <span class="n">t</span><span class="o">=</span><span class="p">(</span><span class="n">t1</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="mi">4</span><span class="p">))</span><span class="o">-</span><span class="n">t2</span><span class="p">;</span>
 <span class="k">return</span> <span class="n">t</span><span class="p">;</span>

<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="3logicalshift">3.logicalShift:</h2>
<blockquote>
<p>找出最高位的符号，然后把算数右移前面补的位数减掉即可
~n+1相当于-n
0xffffffff相当于-1</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/* 
</span><span class="cm"> * logicalShift - shift x to the right by n, using a logical shift
</span><span class="cm"> *   Can assume that 0 &lt;= n &lt;= 31
</span><span class="cm"> *   Examples: logicalShift(0x87654321,4) = 0x08765432
</span><span class="cm"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;
</span><span class="cm"> *   Max ops: 20
</span><span class="cm"> *   Rating: 3 
</span><span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">logicalShift</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/*找出最高位的符号，然后把算数右移前面补的位数减掉即可*/</span>
  <span class="kt">int</span> <span class="n">t</span><span class="p">;</span>
  <span class="n">t</span><span class="o">=</span><span class="n">x</span><span class="o">&gt;&gt;</span><span class="mi">31</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="mi">32</span><span class="o">+</span><span class="p">(</span><span class="o">~</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mh">0xffffffff</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">;</span>
  <span class="n">t</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="o">&gt;&gt;</span><span class="n">n</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="o">~</span><span class="n">t</span><span class="p">);</span> <span class="c1">//这里用了一个mask小技巧，&amp;mask为1的位置就会显露出来
</span><span class="c1"></span>  <span class="k">return</span> <span class="n">t</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="4bitcount">4.bitCount:</h2>
<blockquote>
<p>原理：通过同时批量的运算，把操作次数降下来。先理解只有两位的情况，像是将数字两两划分到一个格子里，01比较好理解，就是降次加和，操作完之后每个盒子里都是二进制表示的“1”的个数。再用0011降次加和，把两个盒子合并成一个盒子，以此类推。计数很巧妙！两位比较好想，但是从两位到四位，即把两个盒子合并到一个大盒子，这个方法也很妙！！</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/*
</span><span class="cm"> * bitCount - returns count of number of 1&#39;s in word
</span><span class="cm"> *   Examples: bitCount(5) = 2, bitCount(7) = 3
</span><span class="cm"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;
</span><span class="cm"> *   Max ops: 40
</span><span class="cm"> *   Rating: 4
</span><span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">bitCount</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/*difficult*/</span>
  <span class="cm">/*原理：通过同时批量的运算，把操作次数降下来。先理解只有两位的情况，像是将数字两两划分到一个格子里，01比较好理解，就是降次加和，操作完之后每个盒子里都是二进制表示的“1”的个数。再用0011降次加和，把两个盒子合并成一个盒子，以此类推。计数很巧妙！两位比较好想，但是从两位到四位，即把两个盒子合并到一个大盒子，这个方法也很妙！！*/</span>
  <span class="kt">int</span> <span class="n">mask1</span><span class="o">=</span><span class="mh">0x55555555</span><span class="p">;</span><span class="c1">//01(循环至32位)01010101
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">mask2</span><span class="o">=</span><span class="mh">0x33333333</span><span class="p">;</span><span class="c1">//0011(循环至32位)
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">mask3</span><span class="o">=</span><span class="mh">0x0f0f0f0f</span><span class="p">;</span><span class="c1">//00001111(循环至32位)
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">mask4</span><span class="o">=</span><span class="mh">0x00ff00ff</span><span class="p">;</span><span class="c1">//0000000011111111(循环至32位)
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">mask5</span><span class="o">=</span><span class="mh">0x0000ffff</span><span class="p">;</span><span class="c1">//00000000000000001111111111111111
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">t</span><span class="p">;</span>
  <span class="n">t</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="o">&amp;</span><span class="n">mask1</span><span class="p">)</span><span class="o">+</span><span class="p">((</span><span class="n">x</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">)</span><span class="o">&amp;</span><span class="n">mask1</span><span class="p">);</span>
  <span class="n">t</span><span class="o">=</span><span class="p">(</span><span class="n">t</span><span class="o">&amp;</span><span class="n">mask2</span><span class="p">)</span><span class="o">+</span><span class="p">((</span><span class="n">t</span><span class="o">&gt;&gt;</span><span class="mi">2</span><span class="p">)</span><span class="o">&amp;</span><span class="n">mask2</span><span class="p">);</span>
  <span class="n">t</span><span class="o">=</span><span class="p">(</span><span class="n">t</span><span class="o">&amp;</span><span class="n">mask3</span><span class="p">)</span><span class="o">+</span><span class="p">((</span><span class="n">t</span><span class="o">&gt;&gt;</span><span class="mi">4</span><span class="p">)</span><span class="o">&amp;</span><span class="n">mask3</span><span class="p">);</span>
  <span class="n">t</span><span class="o">=</span><span class="p">(</span><span class="n">t</span><span class="o">&amp;</span><span class="n">mask4</span><span class="p">)</span><span class="o">+</span><span class="p">((</span><span class="n">t</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">)</span><span class="o">&amp;</span><span class="n">mask4</span><span class="p">);</span>
  <span class="n">t</span><span class="o">=</span><span class="p">(</span><span class="n">t</span><span class="o">&amp;</span><span class="n">mask5</span><span class="p">)</span><span class="o">+</span><span class="p">((</span><span class="n">t</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span><span class="o">&amp;</span><span class="n">mask5</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">t</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="5bang">5.bang:</h2>
<blockquote>
<p>利用0的特性：相反数等于自身。其他的数，相反数和它本身之间肯定有一个负数。</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/* 
</span><span class="cm"> * bang - Compute !x without using !
</span><span class="cm"> *   Examples: bang(3) = 0, bang(0) = 1
</span><span class="cm"> *   Legal ops: ~ &amp; ^ | + &lt;&lt; &gt;&gt;
</span><span class="cm"> *   Max ops: 12
</span><span class="cm"> *   Rating: 4 
</span><span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">bang</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
<span class="cm">/*利用0的特性：相反数等于自身。其他的数，相反数和它本身之间肯定有一个负数。*/</span>
  <span class="k">return</span> <span class="p">((</span><span class="n">x</span><span class="o">|</span><span class="p">(</span><span class="o">~</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">&gt;&gt;</span><span class="mi">31</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span> <span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="6tmin">6.tmin:</h2>
<blockquote>
<p>很简单。根据定义即可。</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/* 
</span><span class="cm"> * tmin - return minimum two&#39;s complement integer 
</span><span class="cm"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;
</span><span class="cm"> *   Max ops: 4
</span><span class="cm"> *   Rating: 1
</span><span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">tmin</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">31</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="7fitsbits">7.fitsBits:</h2>
<blockquote>
<p>就是用两种不同方式去解读，判断能不能表示成n位有符号数。
第n位和第n位之前的位数的数字应该都相同，否则就无法表示。判断是否相同用按位与的方式。</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/* 
</span><span class="cm"> * fitsBits - return 1 if x can be represented as an 
</span><span class="cm"> *  n-bit, two&#39;s complement integer.
</span><span class="cm"> *   1 &lt;= n &lt;= 32
</span><span class="cm"> *   Examples: fitsBits(5,3) = 0, fitsBits(-4,3) = 1
</span><span class="cm">*   Legal ops: !  &amp; ^ | + &lt;&lt; &gt;&gt;
</span><span class="cm"> *   Max ops: 15
</span><span class="cm"> *   Rating: 2
</span><span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">fitsBits</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/*第n位和第n位之前的位数的数字应该都相同，否则就无法表示。*/</span>
  <span class="k">return</span> <span class="o">!</span><span class="p">((</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="mi">32</span><span class="o">-</span><span class="n">n</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="mi">32</span><span class="o">-</span><span class="n">n</span><span class="p">))</span><span class="o">^</span><span class="n">x</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="8divpwr2">8.divpwr2:</h2>
<blockquote>
<p>非整除情况，如果是负数的话，x&raquo;n结果要加一(n非0)。对于对于负数~(x&raquo;31)=0。整除情况如常。</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/* 
</span><span class="cm"> * divpwr2 - Compute x/(2^n), for 0 &lt;= n &lt;= 30
</span><span class="cm"> *  Round toward zero
</span><span class="cm"> *   Examples: divpwr2(15,1) = 7, divpwr2(-33,4) = -2
</span><span class="cm"> *   Legal ops: !   ^ | + &lt;&lt; &gt;&gt;
</span><span class="cm"> *   Max ops: 15
</span><span class="cm"> *   Rating: 2
</span><span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">divpwr2</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/*非整除情况，如果是负数的话，x&gt;&gt;n结果要加一(n非0)。对于对于负数~(x&gt;&gt;31)=0。整除情况如常。*/</span>
  <span class="kt">int</span> <span class="n">s</span><span class="o">=!!</span><span class="p">(</span><span class="n">x</span><span class="o">&gt;&gt;</span><span class="mi">31</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">t</span><span class="o">=!!</span><span class="p">((</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="mi">32</span><span class="o">+~</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">^</span><span class="mi">0</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="o">&gt;&gt;</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">s</span><span class="o">&amp;</span><span class="n">t</span><span class="o">&amp;!!</span><span class="n">n</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="9negate">9.negate:</h2>
<blockquote>
<p>因为 ~x+x=0xffffffff且0xffffffff=-1。所以-x= ~x+1。</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/* 
</span><span class="cm"> * negate - return -x 
</span><span class="cm"> *   Example: negate(1) = -1.
</span><span class="cm"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;
</span><span class="cm"> *   Max ops: 5
</span><span class="cm"> *   Rating: 2
</span><span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">negate</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="o">~</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="10ispositive">10.isPositive:</h2>
<blockquote>
<p>x-1算数右移31位，如果x=0则所有位都为0，否则所有位都为1。</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/* 
</span><span class="cm"> * isPositive - return 1 if x &gt; 0, return 0 otherwise 
</span><span class="cm"> *   Example: isPositive(-1) = 0.
</span><span class="cm"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;
</span><span class="cm"> *   Max ops: 8
</span><span class="cm"> *   Rating: 3
</span><span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">isPositive</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
<span class="cm">/*x-1算数右移31位，如果x=0则所有位都为0，否则所有位都为1。*/</span>
  <span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="n">x</span><span class="o">&gt;&gt;</span><span class="mi">31</span><span class="p">)</span><span class="o">&amp;!!</span><span class="n">x</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="11islessorequal">11.isLessOrEqual:</h2>
<blockquote>
<p>即y-x&gt;=0或y&gt;0,x&lt;0(若溢出)。分类讨论。（y&gt;0,x&gt;0,y-x&gt;0）|（y&gt;0,x&lt;0）|（y&lt;0,x&lt;0,y-x&gt;0）</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/* 
</span><span class="cm"> * isLessOrEqual - if x &lt;= y  then return 1, else return 0 
</span><span class="cm"> *   Example: isLessOrEqual(4,5) = 1.
</span><span class="cm"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;
</span><span class="cm"> *   Max ops: 24
</span><span class="cm"> *   Rating: 3
</span><span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">isLessOrEqual</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/*即y-x&gt;=0或y&gt;0,x&lt;0(若溢出)。分类讨论。*/</span>
  <span class="k">return</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">y</span><span class="o">&gt;&gt;</span><span class="mi">31</span><span class="p">)</span><span class="o">&amp;!</span><span class="p">(</span><span class="n">x</span><span class="o">&gt;&gt;</span><span class="mi">31</span><span class="p">)</span><span class="o">&amp;!</span><span class="p">((</span><span class="n">y</span><span class="o">+~</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">31</span><span class="p">))</span><span class="o">|</span><span class="p">((</span><span class="o">!</span><span class="p">(</span><span class="n">y</span><span class="o">&gt;&gt;</span><span class="mi">31</span><span class="p">))</span><span class="o">&amp;</span><span class="p">(</span><span class="n">x</span><span class="o">&gt;&gt;</span><span class="mi">31</span><span class="p">))</span><span class="o">|</span><span class="p">((</span><span class="n">y</span><span class="o">&gt;&gt;</span><span class="mi">31</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">x</span><span class="o">&gt;&gt;</span><span class="mi">31</span><span class="p">)</span><span class="o">&amp;!</span><span class="p">((</span><span class="n">y</span><span class="o">+~</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">31</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="12ilog2">12.ilog2:</h2>
<blockquote>
<p>找到x的最高的非0位。二分法处理，两部分有无1，用0、1表示；位置用1位移累加。很妙！！</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/*
</span><span class="cm"> * ilog2 - return floor(log base 2 of x), where x &gt; 0
</span><span class="cm"> *   Example: ilog2(16) = 4
</span><span class="cm"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;
</span><span class="cm"> *   Max ops: 90
</span><span class="cm"> *   Rating: 4
</span><span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">ilog2</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/*找到x的最高的非0位。二分法处理，两部分有无1，用0、1表示；位置用1位移累加。很妙！！*/</span>
  <span class="kt">int</span> <span class="n">t</span><span class="p">;</span>
  <span class="n">t</span><span class="o">=</span><span class="p">(</span><span class="o">!!</span><span class="p">(</span><span class="n">x</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">))</span><span class="o">&lt;&lt;</span><span class="mi">4</span><span class="p">;</span>
  <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="o">+</span><span class="p">((</span><span class="o">!!</span><span class="p">(</span><span class="n">x</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="mi">8</span><span class="o">+</span><span class="n">t</span><span class="p">)))</span><span class="o">&lt;&lt;</span><span class="mi">3</span><span class="p">);</span>
  <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="o">+</span><span class="p">((</span><span class="o">!!</span><span class="p">(</span><span class="n">x</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="mi">4</span><span class="o">+</span><span class="n">t</span><span class="p">)))</span><span class="o">&lt;&lt;</span><span class="mi">2</span><span class="p">);</span>
  <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="o">+</span><span class="p">((</span><span class="o">!!</span><span class="p">(</span><span class="n">x</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="n">t</span><span class="p">)))</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">);</span>
  <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="o">+</span><span class="p">(</span><span class="o">!!</span><span class="p">(</span><span class="n">x</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">t</span><span class="p">)));</span>
  <span class="k">return</span> <span class="n">t</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="13float_neg">13.float_neg:</h2>
<blockquote>
<p>判断是否为NaN，然后最高位取反。</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/* 
</span><span class="cm"> * float_neg - Return bit-level equivalent of expression -f for
</span><span class="cm"> *   floating point argument f.
</span><span class="cm"> *   Both the argument and result are passed as unsigned int&#39;s, but
</span><span class="cm"> *   they are to be interpreted as the bit-level representations of
</span><span class="cm"> *   single-precision floating point values.
</span><span class="cm"> *   When argument is NaN, return argument.
</span><span class="cm"> *   Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. also if, while
</span><span class="cm"> *   Max ops: 10
</span><span class="cm"> *   Rating: 2
</span><span class="cm"> */</span>
<span class="kt">unsigned</span> <span class="nf">float_neg</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">uf</span><span class="p">)</span> <span class="p">{</span>
<span class="cm">/*判断是否为NaN，然后最高位取反。*/</span>
 <span class="kt">unsigned</span> <span class="n">exp</span><span class="o">=</span><span class="p">(</span><span class="n">uf</span><span class="o">&amp;</span><span class="mh">0x7ff80000</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">23</span><span class="p">;</span><span class="c1">//011111111100000000000000000000000
</span><span class="c1"></span> <span class="kt">unsigned</span> <span class="n">frac</span><span class="o">=</span><span class="n">uf</span><span class="o">&amp;</span><span class="mh">0x7fffff</span><span class="p">;</span><span class="c1">//00000000011111111111111111111111
</span><span class="c1"></span> <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">exp</span><span class="o">^</span><span class="mh">0xff</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!!</span><span class="p">(</span><span class="n">frac</span><span class="o">^</span><span class="mi">0</span><span class="p">)</span> <span class="p">)</span><span class="c1">//exp=0xff且frac!=0
</span><span class="c1"></span>	    <span class="k">return</span> <span class="n">uf</span><span class="p">;</span><span class="c1">//为NaN返回NaN
</span><span class="c1"></span> <span class="k">return</span> <span class="n">uf</span><span class="o">^</span><span class="mh">0x80000000</span><span class="p">;</span><span class="c1">//s位变号即可
</span><span class="c1"></span> 
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="14float_i2f">14.float_i2f:</h2>
<blockquote>
<p>主要看次数+要不要进位
32-i-1+127即exp
flag是看要不要进位</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/*
</span><span class="cm"> * float_i2f - Return bit-level equivalent of expression (float) x
</span><span class="cm"> *   Result is returned as unsigned int, but
</span><span class="cm"> *   it is to be interpreted as the bit-level representation of a
</span><span class="cm"> *   single-precision floating point values.
</span><span class="cm"> *   Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. also if, while
</span><span class="cm"> *   Max ops: 30
</span><span class="cm"> *   Rating: 4
</span><span class="cm"> */</span>
<span class="kt">unsigned</span> <span class="nf">float_i2f</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">unsigned</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">t</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="n">s</span><span class="o">=</span><span class="p">(</span><span class="o">!!</span><span class="p">(</span><span class="n">x</span><span class="o">&gt;&gt;</span><span class="mi">31</span><span class="p">))</span><span class="o">&lt;&lt;</span><span class="mi">31</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">x</span><span class="o">^</span><span class="mi">0</span><span class="p">))</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span><span class="c1">//为0则0
</span><span class="c1"></span>  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">x</span><span class="o">^</span><span class="mh">0x80000000</span><span class="p">))</span> <span class="k">return</span> <span class="mh">0xcf000000</span><span class="p">;</span><span class="c1">//-2^31
</span><span class="c1"></span>  <span class="k">if</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">x</span><span class="o">=~</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="c1">//负数转换成正数
</span><span class="c1"></span>  <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="p">((</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="n">i</span><span class="p">)</span><span class="o">&amp;</span><span class="mh">0x80000000</span><span class="p">)){</span><span class="c1">//高位不为1就循环
</span><span class="c1"></span>   <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">t</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;&lt;</span><span class="n">i</span><span class="p">)</span><span class="o">-</span><span class="mh">0x80000000</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">flag</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="c1">//若进位，flag变成1
</span><span class="c1"></span>  <span class="k">if</span><span class="p">((</span><span class="n">t</span><span class="o">&amp;</span><span class="mh">0xff</span><span class="p">)</span><span class="o">&gt;</span><span class="mh">0x80</span><span class="p">)</span> <span class="n">flag</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
  <span class="k">else</span><span class="p">{</span>
      <span class="k">if</span><span class="p">((</span><span class="n">t</span><span class="o">&amp;</span><span class="mh">0x180</span><span class="p">)</span><span class="o">==</span><span class="mh">0x180</span><span class="p">)</span> <span class="n">flag</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span>  
  <span class="n">t</span><span class="o">=</span><span class="n">s</span><span class="o">+</span><span class="p">((</span><span class="mi">32</span><span class="o">-</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="mi">127</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">23</span><span class="p">)</span><span class="o">+</span><span class="n">t</span><span class="o">+</span><span class="n">flag</span><span class="p">;</span><span class="c1">//32-i-1+127即exp
</span><span class="c1"></span>  <span class="k">return</span> <span class="n">t</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="15float_twice">15.float_twice:</h2>
<blockquote>
<p>denormalized 的浮点数,exp全为0，乘以2只需将frac左移一位并保持符号不变
normalized 的浮点数，乘以2只需exp++</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cm">/* float_twice - Return bit-level equivalent of expression 2*f for
</span><span class="cm"> *   floating point argument f.
</span><span class="cm"> *   Both the argument and result are passed as unsigned int&#39;s, but
</span><span class="cm"> *   they are to be interpreted as the bit-level representation of
</span><span class="cm"> *   single-precision floating point values.
</span><span class="cm"> *   When argument is NaN, return argument
</span><span class="cm"> *   Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. also if, while
</span><span class="cm"> *   Max ops: 30
</span><span class="cm"> *   Rating: 4
</span><span class="cm"> */</span>
<span class="kt">unsigned</span> <span class="nf">float_twice</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">uf</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">unsigned</span> <span class="n">exp</span><span class="o">=</span><span class="p">(</span><span class="n">uf</span><span class="o">&amp;</span><span class="mh">0x7ff80000</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">23</span><span class="p">;</span><span class="c1">//011111111100000000000000000000000
</span><span class="c1"></span>  <span class="kt">unsigned</span> <span class="n">frac</span><span class="o">=</span><span class="n">uf</span><span class="o">&amp;</span><span class="mh">0x7fffff</span><span class="p">;</span><span class="c1">//00000000011111111111111111111111
</span><span class="c1"></span>  <span class="kt">unsigned</span> <span class="n">t</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">exp</span><span class="o">^</span><span class="mh">0xff</span><span class="p">)</span> <span class="p">){</span>
       <span class="k">return</span> <span class="n">uf</span><span class="p">;</span><span class="c1">//NaN
</span><span class="c1"></span>  <span class="p">}</span>
  <span class="kt">int</span> <span class="n">k</span><span class="o">=!!</span><span class="p">(</span><span class="n">uf</span><span class="o">&amp;</span><span class="mh">0x7fffffff</span><span class="p">)</span><span class="o">&amp;!!</span><span class="n">exp</span><span class="p">;</span>
  <span class="n">t</span><span class="o">=</span><span class="p">(</span><span class="n">uf</span><span class="o">&amp;</span><span class="mh">0x80000000</span><span class="p">)</span><span class="o">+</span><span class="p">((</span><span class="n">exp</span><span class="o">+</span><span class="n">k</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">23</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">frac</span><span class="o">&lt;&lt;!</span><span class="n">exp</span><span class="p">);</span><span class="c1">//s+exp+frac//exp全0的，frac&lt;&lt;1,exp不变;否则exp++
</span><span class="c1"></span>  <span class="k">return</span> <span class="n">t</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></td></tr></table>
</div>
</div><h2 id="结果">结果：</h2>
<p>./btest</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://img-blog.csdnimg.cn/20210131231631758.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0lzYXJheQ==,size_16,color_FFFFFF,t_70#pic_center"
        data-srcset="https://img-blog.csdnimg.cn/20210131231631758.png?x-oss-process=image/watermark%2ctype_ZmFuZ3poZW5naGVpdGk%2cshadow_10%2ctext_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0lzYXJheQ==%2csize_16%2ccolor_FFFFFF%2ct_70#pic_center, https://img-blog.csdnimg.cn/20210131231631758.png?x-oss-process=image/watermark%2ctype_ZmFuZ3poZW5naGVpdGk%2cshadow_10%2ctext_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0lzYXJheQ==%2csize_16%2ccolor_FFFFFF%2ct_70#pic_center 1.5x, https://img-blog.csdnimg.cn/20210131231631758.png?x-oss-process=image/watermark%2ctype_ZmFuZ3poZW5naGVpdGk%2cshadow_10%2ctext_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0lzYXJheQ==%2csize_16%2ccolor_FFFFFF%2ct_70#pic_center 2x"
        data-sizes="auto"
        alt="https://img-blog.csdnimg.cn/20210131231631758.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0lzYXJheQ==,size_16,color_FFFFFF,t_70#pic_center"
        title="在这里插入图片描述" /></p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2022-01-31</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://Isaray.github.io/csapp-datalab/" data-title="CSAPP:datalab" data-hashtags="CSAPP,Courses"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://Isaray.github.io/csapp-datalab/" data-hashtag="CSAPP"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="Share on WhatsApp" data-sharer="whatsapp" data-url="https://Isaray.github.io/csapp-datalab/" data-title="CSAPP:datalab" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="https://Isaray.github.io/csapp-datalab/" data-title="CSAPP:datalab"><i data-svg-src="/lib/simple-icons/icons/line.min.svg"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="https://Isaray.github.io/csapp-datalab/" data-title="CSAPP:datalab"><i class="fab fa-weibo fa-fw"></i></a><a href="javascript:void(0);" title="Share on Myspace" data-sharer="myspace" data-url="https://Isaray.github.io/csapp-datalab/" data-title="CSAPP:datalab" data-description="How to solve datalab?"><i data-svg-src="/lib/simple-icons/icons/myspace.min.svg"></i></a><a href="javascript:void(0);" title="Share on Blogger" data-sharer="blogger" data-url="https://Isaray.github.io/csapp-datalab/" data-title="CSAPP:datalab" data-description="How to solve datalab?"><i class="fab fa-blogger fa-fw"></i></a><a href="javascript:void(0);" title="Share on Evernote" data-sharer="evernote" data-url="https://Isaray.github.io/csapp-datalab/" data-title="CSAPP:datalab"><i class="fab fa-evernote fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/csapp/">CSAPP</a>,&nbsp;<a href="/tags/courses/">Courses</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" class="prev" rel="prev" title=""><i class="fas fa-angle-left fa-fw"></i></a>
            <a href="/csapp-bomblab/" class="next" rel="next" title="CSAPP:bomblab">CSAPP:bomblab<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.92.0">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2019 - 2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Isaray</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer>
        </div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/lightgallery/lightgallery.min.css"><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-thumbnail.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-zoom.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/mhchem.min.js"></script><script type="text/javascript" src="/lib/cookieconsent/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10},"comment":{},"cookieconsent":{"content":{"dismiss":"Got it!","link":"Learn more","message":"This website uses Cookies to improve your experience."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
